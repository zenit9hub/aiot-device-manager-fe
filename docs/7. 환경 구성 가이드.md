# 7. 환경 구성 가이드

## 7.1 요구 사양
| 항목 | 값 |
| --- | --- |
| OS | macOS / Windows / Linux (Docker Desktop 필수) |
| Node.js | 18.17 이상 |
| npm | 9.x 이상 |
| Docker | 24.x 이상 (Compose 포함) |
| Git | 최신 |

## 7.2 설치 흐름
```mermaid
flowchart TD
  Start([시작]) --> Node[Node.js 설치]
  Node --> Git[Git 설치 및 클론]
  Git --> Firebase[Firebase 프로젝트 설정]
  Firebase --> Docker[Docker Desktop 실행]
  Docker --> BackendEnv[백엔드 .env 작성]
  BackendEnv --> FrontendEnv[프론트엔드 .env 작성]
  FrontendEnv --> MQTT[MQTT 브로커 주소 확인]
  MQTT --> End([준비 완료])
```

## 7.3 레포지토리 구조
```bash
.
├── aiot-device-manager-fe-working/   # 프론트엔드
├── aiot-device-manager-be-working/   # 백엔드
├── docs/                             # 교육 문서
├── README.md
└── CLOUD_DEPLOYMENT_GUIDE.md
```

## 7.4 환경 변수 템플릿
### 프론트엔드 (`aiot-device-manager-fe-working/.env`)
```env
VITE_FIREBASE_API_KEY=...
VITE_FIREBASE_AUTH_DOMAIN=...
VITE_FIREBASE_PROJECT_ID=...
VITE_FIREBASE_STORAGE_BUCKET=...
VITE_FIREBASE_MESSAGING_SENDER_ID=...
VITE_FIREBASE_APP_ID=...
VITE_FIREBASE_MEASUREMENT_ID=...

# 선택적 백엔드 연동
VITE_BACKEND_BASE_URL=http://localhost:4000
VITE_TOKEN_CACHE_MINUTES=5
```

### 백엔드 (`aiot-device-manager-be-working/.env`)
```env
PORT=4000
MYSQL_HOST=127.0.0.1
MYSQL_PORT=3306
MYSQL_USER=appuser
MYSQL_PASSWORD=appsecret
MYSQL_DATABASE=aiot_device_manager

FIREBASE_PROJECT_ID=...
FIREBASE_CLIENT_EMAIL=...
FIREBASE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n"

ALLOWED_ORIGINS=http://localhost:5173
```

## 7.5 실행 절차
```mermaid
sequenceDiagram
  participant Dev as 개발자
  participant Docker as Docker Compose
  participant BE as Backend
  participant FE as Frontend

  Dev->>Docker: docker compose up -d
  Docker-->>Dev: MySQL 준비 완료
  Dev->>BE: npm install && npm run dev
  Dev->>FE: npm install && npm run dev
  FE-->>Dev: http://localhost:5173
```

## 7.6 체크리스트
- [ ] Firebase 프로젝트 생성 및 웹 앱 등록 완료.
- [ ] 서비스 계정 비공개 키 다운로드 및 `.env` 주입.
- [ ] Docker Desktop 실행 및 포트 충돌 없음.
- [ ] MQTT 브로커 주소 테스트 (HiveMQ 등).
- [ ] 프론트/백엔드 모두 `npm install` 실행.

## 7.7 공용 툴
| 도구 | 용도 |
| --- | --- |
| `npm run dev` | 개발 서버 실행 |
| `docker compose up -d` | MySQL 실행 |
| `npm run build` | 프로덕션 번들 생성 |
| `mysql -h 127.0.0.1 -u appuser -p` | DB 접속 확인 |

## 7.8 문제 발생 시
- 포트 충돌: 5173(프론트), 4000(백엔드), 3306(MySQL) 사용 여부 점검.
- `.env` invalid 오류: Zod 에러 메시지 확인 후 값 검증.
- MQTT 연결 실패: 방화벽, ws/wss 프로토콜 설정 확인.
